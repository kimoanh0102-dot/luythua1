<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To√°n 11 - Gi√°m s√°t & Thu th·∫≠p d·ªØ li·ªáu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; background-color: #f0f4f8; color: #1e293b; }
        .math-card { transition: all 0.3s ease; }
        .option-btn { transition: all 0.2s; border: 2px solid #cbd5e1; }
        .option-btn:hover:not(.correct):not(.wrong) { border-color: #3b82f6; background-color: #f0f9ff; }
        .option-btn.correct { border-color: #22c55e; background-color: #f0fdf4; color: #15803d; font-weight: bold; }
        .option-btn.wrong { border-color: #ef4444; background-color: #fef2f2; color: #b91c1c; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .cheat-warning { animation: pulse-red 1.5s infinite; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- C·∫£nh b√°o gi√°m s√°t (Overlay) -->
    <div id="cheat-modal" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl max-w-sm w-full text-center space-y-4 cheat-warning">
            <div class="text-5xl">‚ö†Ô∏è</div>
            <h3 class="text-xl font-black text-red-600">C·∫¢NH B√ÅO GI√ÅM S√ÅT</h3>
            <p class="text-gray-600 text-sm font-medium">B·∫°n v·ª´a tho√°t kh·ªèi m√†n h√¨nh l√†m b√†i ho·∫∑c chuy·ªÉn tab. H√†nh vi n√†y ƒë√£ ƒë∆∞·ª£c ghi l·∫°i v√†o h·ªá th·ªëng.</p>
            <button onclick="closeCheatModal()" class="w-full bg-red-600 text-white font-bold py-3 rounded-xl hover:bg-red-700">T√îI ƒê√É HI·ªÇU</button>
        </div>
    </div>

    <!-- Header -->
    <header id="main-header" class="hidden fixed top-0 left-0 w-full bg-white/90 backdrop-blur shadow-sm p-4 z-50">
        <div class="max-w-2xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <div class="flex flex-col leading-tight">
                    <span id="header-user" class="font-bold text-gray-800 text-sm"></span>
                    <span id="header-class" class="text-gray-400 text-[10px] uppercase font-bold tracking-widest"></span>
                </div>
            </div>
            <div id="quiz-progress" class="flex-1 mx-8">
                <div class="w-full bg-gray-100 rounded-full h-2">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            <div id="quiz-timer" class="font-mono font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-lg text-sm border border-blue-100">10:00</div>
        </div>
    </header>

    <main class="w-full max-w-xl">
        <!-- SCREEN LOGIN -->
        <div id="screen-login" class="bg-white p-10 rounded-[2.5rem] shadow-2xl space-y-8">
            <div class="text-center space-y-2">
                <div class="bg-blue-600 text-white w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-6 text-4xl shadow-xl shadow-blue-200">Œ£</div>
                <h1 class="text-3xl font-black text-gray-900 tracking-tight">H·ªá Th·ªëng Ki·ªÉm Tra</h1>
                <p class="text-gray-400 font-medium">Ch∆∞∆°ng II: L≈©y Th·ª´a & CƒÉn Th·ª©c</p>
                <div class="inline-flex items-center bg-amber-50 text-amber-700 text-[10px] px-3 py-1 rounded-full font-bold uppercase mt-2">
                    üöÄ Ch·∫ø ƒë·ªô gi√°m s√°t t·ª± ƒë·ªông ƒëang b·∫≠t
                </div>
            </div>
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-xs font-black text-gray-500 uppercase ml-2">H·ªç v√† t√™n h·ªçc sinh</label>
                    <input type="text" id="name-input" placeholder="Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß..." class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 outline-none transition-all font-semibold">
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-black text-gray-500 uppercase ml-2">L·ªõp</label>
                    <input type="text" id="class-input" placeholder="V√≠ d·ª•: 11A1..." class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 outline-none transition-all font-semibold">
                </div>
                <button onclick="handleLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl shadow-xl shadow-blue-100 transition-all active:scale-95">V√ÄO PH√íNG THI</button>
            </div>
        </div>

        <!-- SCREEN MENU -->
        <div id="screen-menu" class="hidden space-y-6">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-black text-gray-800" id="welcome-msg">Ch√†o m·ª´ng!</h2>
                <p class="text-gray-500">Vui l√≤ng ch·ªçn b·ªô ƒë·ªÅ thi b√™n d∆∞·ªõi.</p>
            </div>
            <div class="grid gap-4">
                <button onclick="startQuiz(0)" class="bg-white p-6 rounded-[2rem] shadow-sm border-2 border-transparent hover:border-blue-500 text-left flex items-center group transition-all">
                    <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center font-black mr-5 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-sm">01</div>
                    <div class="flex-1">
                        <div class="font-black text-gray-800 text-lg">L√Ω thuy·∫øt & M·ªánh ƒë·ªÅ</div>
                        <div class="text-gray-400 text-xs font-bold uppercase tracking-wider">10 c√¢u - 10 ph√∫t</div>
                    </div>
                </button>
                <button onclick="startQuiz(1)" class="bg-white p-6 rounded-[2rem] shadow-sm border-2 border-transparent hover:border-purple-500 text-left flex items-center group transition-all">
                    <div class="w-14 h-14 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center font-black mr-5 group-hover:bg-purple-600 group-hover:text-white transition-all shadow-sm">02</div>
                    <div class="flex-1">
                        <div class="font-black text-gray-800 text-lg">Bi·∫øn ƒë·ªïi bi·ªÉu th·ª©c</div>
                        <div class="text-gray-400 text-xs font-bold uppercase tracking-wider">10 c√¢u - 10 ph√∫t</div>
                    </div>
                </button>
            </div>
        </div>

        <!-- SCREEN QUIZ -->
        <div id="screen-quiz" class="hidden space-y-6">
            <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                    <svg width="100" height="100" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 3.45l8.27 14.3H3.73L12 5.45zM11 16h2v2h-2v-2zm0-7h2v5h-2V9z"/></svg>
                </div>
                <div id="q-label" class="text-[10px] font-black text-blue-600 uppercase tracking-[0.2em] mb-4">C√¢u h·ªèi 1/10</div>
                <div id="q-text" class="text-xl font-bold text-gray-800 leading-relaxed min-h-[80px]"></div>
            </div>
            <div id="options" class="grid gap-3"></div>
            
            <div id="feedback" class="hidden bg-white p-8 rounded-[2rem] shadow-2xl border-2 animate-pop border-blue-50">
                <div id="fb-status" class="flex items-center space-x-2 font-black mb-4"></div>
                <div class="text-[10px] font-black text-gray-300 uppercase tracking-widest mb-2">H∆∞·ªõng d·∫´n chi ti·∫øt:</div>
                <div id="fb-explanation" class="text-gray-600 text-sm leading-relaxed space-y-2"></div>
                <button id="next-btn" class="w-full mt-8 bg-gray-900 text-white font-black py-5 rounded-2xl hover:bg-black transition-all shadow-xl">TI·∫æP T·ª§C</button>
            </div>
        </div>

        <!-- SCREEN RESULT -->
        <div id="screen-result" class="hidden text-center space-y-8 py-10">
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl space-y-6">
                <div class="text-6xl">üìä</div>
                <h2 class="text-4xl font-black text-gray-900">K·∫øt qu·∫£ thi</h2>
                <div id="res-info" class="text-blue-600 font-black tracking-widest text-sm"></div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-6 rounded-3xl border border-blue-100">
                        <div class="text-[10px] text-blue-400 font-black uppercase mb-1">ƒêi·ªÉm s·ªë</div>
                        <div id="res-score" class="text-3xl font-black text-blue-700">0/10</div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-3xl border border-gray-100">
                        <div class="text-[10px] text-gray-400 font-black uppercase mb-1">Th·ªùi gian</div>
                        <div id="res-time" class="text-3xl font-black text-gray-800">00:00</div>
                    </div>
                </div>

                <div class="bg-red-50 p-4 rounded-2xl border border-red-100 flex justify-between items-center">
                    <div class="text-[10px] text-red-500 font-black uppercase">S·ªë l·∫ßn tho√°t m√†n h√¨nh:</div>
                    <div id="res-cheats" class="text-xl font-black text-red-600">0</div>
                </div>

                <div class="bg-blue-600 text-white p-6 rounded-3xl text-left relative overflow-hidden">
                    <h3 class="font-black text-xs uppercase tracking-widest mb-2">Ph√¢n t√≠ch chuy√™n s√¢u:</h3>
                    <p id="res-ai" class="text-blue-50 text-sm leading-relaxed opacity-90 font-medium"></p>
                </div>
                
                <div id="data-status" class="text-[10px] font-bold text-gray-400">ƒêang l∆∞u d·ªØ li·ªáu l√™n h·ªá th·ªëng...</div>
                <button onclick="location.reload()" class="w-full bg-gray-100 text-gray-800 font-black py-5 rounded-2xl hover:bg-gray-200">K·∫æT TH√öC</button>
            </div>
        </div>
    </main>

    <script>
        // --- C·∫§U H√åNH ---
        // D√°n URL Google Apps Script c·ªßa b·∫°n v√†o ƒë√¢y
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5HmmUALA22qaEX4zkcraJgUhCfe1KsYwz3RnSMfYaKsGlIukW29muverY7RBxwHXB/exec";

        const quizData = [
            // B·ªò ƒê·ªÄ 01
            [
                {
                    q: "V·ªõi $a$ l√† s·ªë th·ª±c b·∫•t k√¨, m·ªánh ƒë·ªÅ n√†o sau ƒë√¢y **sai**?",
                    o: ["$\\sqrt{a^2} = |a|$ ", "$\\sqrt[3]{a^3} = a$", "$\\sqrt[4]{a^4} = a$", "$\\sqrt[5]{a^5} = a$"],
                    a: 2,
                    e: "Theo ƒë·ªãnh nghƒ©a cƒÉn b·∫≠c $n$:<br>1. N·∫øu $n$ l·∫ª: $\\sqrt[n]{a^n} = a$.<br>2. N·∫øu $n$ ch·∫µn: $\\sqrt[n]{a^n} = |a|$.<br>V·∫≠y $\\sqrt[4]{a^4} = |a|$. M·ªánh ƒë·ªÅ C sai v√¨ thi·∫øu d·∫•u gi√° tr·ªã tuy·ªát ƒë·ªëi."
                },
                {
                    q: "V·ªõi $a$ l√† s·ªë th·ª±c d∆∞∆°ng t√πy √Ω, bi·ªÉu th·ª©c $a^2 \\cdot \\sqrt{a}$ b·∫±ng:",
                    o: ["$a^1$", "$a^{\\frac{3}{2}}$", "$a^{\\frac{5}{2}}$", "$a^4$"],
                    a: 2,
                    e: "Bi·∫øn ƒë·ªïi cƒÉn th·ª©c v·ªÅ l≈©y th·ª´a: $\\sqrt{a} = a^{\\frac{1}{2}}$. √Åp d·ª•ng nh√¢n hai l≈©y th·ª´a c√πng c∆° s·ªë: $a^2 \\cdot a^{\\frac{1}{2}} = a^{2 + \\frac{1}{2}} = a^{\\frac{5}{2}}$."
                },
                {
                    q: "M·ªánh ƒë·ªÅ n√†o sau ƒë√¢y ƒë√∫ng v·ªõi m·ªçi $a, b > 0$ v√† s·ªë nguy√™n d∆∞∆°ng $n \\ge 2$?",
                    o: ["$\\sqrt[n]{a+b} = \\sqrt[n]{a} + \\sqrt[n]{b}$", "$\\sqrt[n]{ab} = \\sqrt[n]{a} \\cdot \\sqrt[n]{b}$", "$\\sqrt[n]{a-b} = \\sqrt[n]{a} - \\sqrt[n]{b}$", "$\\frac{\\sqrt[n]{a}}{\\sqrt[n]{b}} = \\sqrt[n]{a-b}$"],
                    a: 1,
                    e: "T√≠nh ch·∫•t cƒÉn b·∫≠c $n$: CƒÉn c·ªßa m·ªôt t√≠ch b·∫±ng t√≠ch c√°c cƒÉn. C√°c ph√©p c·ªông, tr·ª´ kh√¥ng c√≥ t√≠nh ch·∫•t n√†y."
                },
                {
                    q: "Cho $a$ l√† s·ªë th·ª±c d∆∞∆°ng t√πy √Ω, bi·ªÉu th·ª©c $a^{\\frac{1}{4}} \\cdot \\sqrt{a}$ b·∫±ng:",
                    o: ["$a^1$", "$a^{\\frac{3}{4}}$", "$a^{\\frac{1}{2}}$", "$a^{\\frac{5}{4}}$"],
                    a: 1,
                    e: "$a^{\\frac{1}{4}} \\cdot a^{\\frac{1}{2}} = a^{\\frac{1}{4} + \\frac{1}{2}} = a^{\\frac{3}{4}}$."
                },
                {
                    q: "R√∫t g·ªçn bi·ªÉu th·ª©c $P = \\sqrt[3]{x \\cdot \\sqrt[4]{x}}$ v·ªõi $x > 0$:",
                    o: ["$x^{\\frac{1}{12}}$", "$x^{\\frac{5}{12}}$", "$x^{\\frac{2}{3}}$", "$x^{\\frac{4}{3}}$"],
                    a: 1,
                    e: "Bi·∫øn ƒë·ªïi t·ª´ trong ra: $\\sqrt[4]{x} = x^{\\frac{1}{4}} \\Rightarrow x \\cdot x^{\\frac{1}{4}} = x^{\\frac{5}{4}} \\Rightarrow \\sqrt[3]{x^{\\frac{5}{4}}} = x^{\\frac{5}{12}}$."
                },
                {
                    q: "N·∫øu $a^{\\frac{1}{2}} > a^{\\frac{1}{6}}$ th√¨ ƒëi·ªÅu ki·ªán c·ªßa $a$ l√†:",
                    o: ["$a < 0$", "$0 < a < 1$", "$a > 1$", "$a = 1$"],
                    a: 2,
                    e: "V√¨ s·ªë m≈© $\\frac{1}{2} > \\frac{1}{6}$ v√† h√†m s·ªë l≈©y th·ª´a gi·ªØ nguy√™n chi·ªÅu so s√°nh n√™n c∆° s·ªë $a > 1$."
                },
                {
                    q: "Cho $P = a^{\\frac{1}{3}} \\cdot \\sqrt{a}$ v·ªõi $a > 0$. Kh·∫≥ng ƒë·ªãnh ƒë√∫ng l√†:",
                    o: ["$P = a^{\\frac{1}{6}}$", "$P = a^{\\frac{2}{3}}$", "$P = a^{\\frac{1}{2}}$", "$P = a^{\\frac{5}{6}}$"],
                    a: 3,
                    e: "$P = a^{\\frac{1}{3} + \\frac{1}{2}} = a^{\\frac{5}{6}}$."
                },
                {
                    q: "C√¥ng th·ª©c l≈©y th·ª´a n√†o sau ƒë√¢y **SAI**?",
                    o: ["$(ab)^n = a^n b^n$", "$a^m a^n = a^{m+n}$", "$(a^m)^n = a^{m+n}$", "$\\frac{a^m}{a^n} = a^{m-n}$"],
                    a: 2,
                    e: "Sai ·ªü C. Quy t·∫Øc ƒë√∫ng: $(a^m)^n = a^{m \\cdot n}$."
                },
                {
                    q: "Vi·∫øt $a^{\\frac{2}{3}} \\cdot \\sqrt{a}$ ($a>0$) d∆∞·ªõi d·∫°ng l≈©y th·ª´a:",
                    o: ["$a^{\\frac{5}{6}}$", "$a^{\\frac{1}{3}}$", "$a^{\\frac{7}{6}}$", "$a^{\\frac{4}{3}}$"],
                    a: 2,
                    e: "$\\frac{2}{3} + \\frac{1}{2} = \\frac{7}{6}$."
                },
                {
                    q: "Bi·ªÉu th·ª©c t∆∞∆°ng ƒë∆∞∆°ng v·ªõi $\\sqrt[n]{a}$ ($a>0, n \\ge 2$)?",
                    o: ["$a^n$", "$a^{\\frac{1}{n}}$", "$a^{n-1}$", "$a^{-n}$"],
                    a: 1,
                    e: "Theo ƒë·ªãnh nghƒ©a: $\\sqrt[n]{a} = a^{1/n}$."
                }
            ],
            // B·ªò ƒê·ªÄ 02
            [
                {
                    q: "T√≠nh gi√° tr·ªã $P = \\sqrt[3]{2 \\cdot \\sqrt[5]{16}} \\cdot 8^{\\frac{2}{15}}$",
                    o: ["2", "4", "$\\sqrt{2}$", "1"],
                    a: 0,
                    e: "ƒê∆∞a v·ªÅ c∆° s·ªë 2: $\\sqrt[3]{2 \\cdot 2^{4/5}} = 2^{3/5} = 2^{9/15}$. Nh√¢n v·ªõi $2^{6/15} \\Rightarrow 2^1 = 2$."
                },
                {
                    q: "R√∫t g·ªçn $P = \\frac{a^{\\sqrt{3}+1} \\cdot a^{2-\\sqrt{3}}}{(a^{\\sqrt{2}-2})^{\\sqrt{2}+2}}$ ($a > 0$):",
                    o: ["$a^1$", "$a^3$", "$a^4$", "$a^5$"],
                    a: 3,
                    e: "T·ª≠ s·ªë: $a^3$. M·∫´u s·ªë: $a^{2-4} = a^{-2}$. K·∫øt qu·∫£ $a^3 / a^{-2} = a^5$."
                },
                {
                    q: "R√∫t g·ªçn $K = \\sqrt[3]{\\sqrt{a^4 \\cdot \\sqrt[3]{a}}}$ ($a > 0$):",
                    o: ["$a^{\\frac{1}{2}}$", "$a^{\\frac{13}{9}}$", "$a^{\\frac{13}{18}}$", "$a^{\\frac{14}{15}}$"],
                    a: 2,
                    e: "Bi·∫øn ƒë·ªïi t·∫ßng: $a^{(4+1/3) \\cdot 1/2 \\cdot 1/3} = a^{13/18}$."
                },
                {
                    q: "Cho $x = 2$, t√≠nh gi√° tr·ªã $x^{\\frac{3}{4}} \\cdot \\sqrt[4]{x}$:",
                    o: ["2", "4", "$\\sqrt{2}$", "1"],
                    a: 0,
                    e: "$x^{3/4 + 1/4} = x^1 = 2$."
                },
                {
                    q: "Bi·∫øt $a = \\frac{\\sqrt[3]{16}}{\\sqrt[4]{8}} = 2^k$. T√¨m $k$?",
                    o: ["$7/12$", "$5/12$", "$1/12$", "$11/12$"],
                    a: 0,
                    e: "$k = 4/3 - 3/4 = 7/12$."
                },
                {
                    q: "Vi·∫øt $\\sqrt{x} \\cdot \\sqrt[3]{x} \\cdot \\sqrt[6]{x^5}$ ($x>0$) d∆∞·ªõi d·∫°ng l≈©y th·ª´a:",
                    o: ["$x^2$", "$x^{\\frac{5}{6}}$", "$x^{\\frac{5}{3}}$", "$x^1$"],
                    a: 2,
                    e: "$1/2 + 1/3 + 5/6 = 10/6 = 5/3$."
                },
                {
                    q: "N·∫øu $a+b=1$, t√≠nh $P = \\frac{a^{\\frac{1}{3}}\\sqrt{b} + b^{\\frac{1}{3}}\\sqrt{a}}{\\sqrt[6]{a} + \\sqrt[6]{b}}$:",
                    o: ["$\\sqrt[3]{ab}$", "$\\sqrt{ab}$", "$a+b$", "$\\sqrt[6]{ab}$"],
                    a: 0,
                    e: "ƒê·∫∑t $(ab)^{1/3}$ l√†m nh√¢n t·ª≠ chung ·ªü t·ª≠ s·ªë, r√∫t g·ªçn ƒë∆∞·ª£c $\\sqrt[3]{ab}$."
                },
                {
                    q: "T√≠nh $A = \\sqrt[3]{7 \\cdot \\sqrt{7 \\cdot \\sqrt[3]{7}}} \\cdot 7^{\\frac{13}{9}}$:",
                    o: ["7", "49", "1", "343"],
                    a: 1,
                    e: "$7^{5/9} \\cdot 7^{13/9} = 7^{18/9} = 7^2 = 49$."
                },
                {
                    q: "R√∫t g·ªçn $M = (a^{-1} + b^{-1}) : (a+b)$ ($a, b > 0$):",
                    o: ["$ab$", "$1/ab$", "$a+b$", "1"],
                    a: 1,
                    e: "$(1/a + 1/b) : (a+b) = \\frac{a+b}{ab} \\cdot \\frac{1}{a+b} = 1/ab$."
                },
                {
                    q: "T√≠nh $A = 27^{\\frac{1}{3}} - 16^{\\frac{1}{4}} + 25^{\\frac{1}{2}}$:",
                    o: ["6", "4", "10", "12"],
                    a: 0,
                    e: "$3 - 2 + 5 = 6$."
                }
            ]
        ];

        let userName = "", userClass = "";
        let currentSet = 0, currentQuestion = 0, score = 0;
        let timeLeft = 600, timerId = null;
        let startTime = 0, cheatCount = 0;

        // --- H·ªÜ TH·ªêNG GI√ÅM S√ÅT ---
        document.addEventListener("visibilitychange", function() {
            if (document.visibilityState === 'hidden' && timerId) {
                cheatCount++;
                document.getElementById('cheat-modal').classList.remove('hidden');
            }
        });

        window.onblur = function() {
            if (timerId) {
                // C√≥ th·ªÉ b·ªè qua n·∫øu mu·ªën ch·ªâ d√πng visibilitychange
                // cheatCount++; 
            }
        };

        function closeCheatModal() {
            document.getElementById('cheat-modal').classList.add('hidden');
        }

        function handleLogin() {
            userName = document.getElementById('name-input').value.trim();
            userClass = document.getElementById('class-input').value.trim();
            if (!userName || !userClass) {
                alert("B·∫°n ch∆∞a nh·∫≠p ƒë·ªß th√¥ng tin k√¨a!");
                return;
            }
            document.getElementById('welcome-msg').innerText = `Ch√†o ${userName}! üéØ`;
            switchScreen('screen-menu');
        }

        function switchScreen(id) {
            ['screen-login', 'screen-menu', 'screen-quiz', 'screen-result'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }

        function startQuiz(setIndex) {
            currentSet = setIndex;
            currentQuestion = 0;
            score = 0;
            timeLeft = 600;
            cheatCount = 0;
            startTime = Date.now();
            
            document.getElementById('header-user').innerText = userName.toUpperCase();
            document.getElementById('header-class').innerText = "L·ªöP: " + userClass;
            document.getElementById('main-header').classList.remove('hidden');
            
            switchScreen('screen-quiz');
            loadQuestion();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerId);
            timerId = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60);
                const s = timeLeft % 60;
                document.getElementById('quiz-timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if (timeLeft <= 0) endQuiz();
            }, 1000);
        }

        function loadQuestion() {
            const data = quizData[currentSet][currentQuestion];
            document.getElementById('q-label').innerText = `C√ÇU H·ªéI ${currentQuestion + 1}/${quizData[currentSet].length}`;
            document.getElementById('q-text').innerHTML = data.q;
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            data.o.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full bg-white p-5 rounded-2xl text-left flex items-center shadow-sm font-bold animate-pop";
                btn.innerHTML = `<span class="bg-gray-100 text-gray-400 w-8 h-8 rounded-lg flex items-center justify-center mr-4 font-black text-xs transition-colors">${String.fromCharCode(65 + idx)}</span> <span class="flex-1">${opt}</span>`;
                btn.onclick = () => checkAnswer(idx, btn);
                optionsDiv.appendChild(btn);
            });

            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('progress-bar').style.width = `${(currentQuestion / quizData[currentSet].length) * 100}%`;
            renderMathContent();
        }

        function checkAnswer(idx, btn) {
            const data = quizData[currentSet][currentQuestion];
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.onclick = null);

            if (idx === data.a) {
                btn.classList.add('correct');
                btn.querySelector('span').classList.add('bg-green-500', 'text-white');
                score++;
                document.getElementById('fb-status').innerHTML = `<span class="text-green-600">‚úì R·∫§T GI·ªéI!</span>`;
            } else {
                btn.classList.add('wrong');
                btn.querySelector('span').classList.add('bg-red-500', 'text-white');
                btns[data.a].classList.add('correct');
                document.getElementById('fb-status').innerHTML = `<span class="text-red-600">‚úï CH∆ØA CH√çNH X√ÅC</span>`;
            }

            document.getElementById('fb-explanation').innerHTML = data.e;
            document.getElementById('feedback').classList.remove('hidden');
            renderMathContent();

            document.getElementById('next-btn').onclick = () => {
                currentQuestion++;
                if (currentQuestion < quizData[currentSet].length) {
                    loadQuestion();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    endQuiz();
                }
            };
        }

        async function endQuiz() {
            clearInterval(timerId);
            timerId = null;
            document.getElementById('main-header').classList.add('hidden');
            switchScreen('screen-result');

            const duration = Math.floor((Date.now() - startTime) / 1000);
            const m = Math.floor(duration / 60);
            const s = duration % 60;
            const timeStr = `${m}:${s < 10 ? '0'+s : s}`;

            document.getElementById('res-info').innerText = `${userName.toUpperCase()} - L·ªöP ${userClass}`;
            document.getElementById('res-score').innerText = `${score}/10`;
            document.getElementById('res-time').innerText = timeStr;
            document.getElementById('res-cheats').innerText = cheatCount;

            let aiMsg = "";
            if (score === 10 && cheatCount === 0) aiMsg = "Ho√†n h·∫£o! B·∫°n kh√¥ng ch·ªâ n·∫Øm v·ªØng ki·∫øn th·ª©c m√† c√≤n r·∫•t nghi√™m t√∫c trong b√†i ki·ªÉm tra.";
            else if (score >= 7) aiMsg = "R·∫•t t·ªët! B·∫°n hi·ªÉu b√†i nh∆∞ng c·∫ßn ch√∫ √Ω h∆°n v·ªÅ t·ªëc ƒë·ªô v√† t√≠nh t·ªâ m·ªâ.";
            else aiMsg = "C·∫ßn n·ªó l·ª±c h∆°n! H√£y xem l·∫°i c√°c b∆∞·ªõc gi·∫£i chi ti·∫øt ƒë·ªÉ r√∫t kinh nghi·ªám.";

            document.getElementById('res-ai').innerText = aiMsg;

            // G·ª¨I D·ªÆ LI·ªÜU L√äN GOOGLE SHEETS
            if (GOOGLE_SCRIPT_URL !== "D√ÅN_URL_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY") {
                try {
                    const payload = {
                        name: userName,
                        class: userClass,
                        quizSet: currentSet + 1,
                        score: score,
                        total: quizData[currentSet].length,
                        timeSpent: timeStr,
                        cheatCount: cheatCount,
                        status: cheatCount > 0 ? "Ph√°t hi·ªán gian l·∫≠n" : "Nghi√™m t√∫c"
                    };
                    
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    document.getElementById('data-status').innerText = "‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng.";
                } catch (err) {
                    document.getElementById('data-status').innerText = "‚ùå L·ªói khi g·ª≠i d·ªØ li·ªáu.";
                }
            } else {
                document.getElementById('data-status').innerText = "‚ö†Ô∏è Ch∆∞a c·∫•u h√¨nh URL Google Sheet.";
            }
        }

        function renderMathContent() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }

        window.onload = () => { renderMathContent(); };
    </script>
</body>
</html>